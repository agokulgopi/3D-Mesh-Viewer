<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Mesh Showcase</title>

  <style>
    :root{
      --ui-bg: rgba(51,51,51,0.9);
      --ui-color: #fff;
      --thumb-size: 84px;
    }

    html,body{
      height:100%;
      margin:0;
      background:#ffffff;
      font-family: Arial, sans-serif;
      overflow:hidden;
    }

    /* -------------------------------------------------- */
    /* MAIN FULLSCREEN VIEWER AREA                        */
    /* -------------------------------------------------- */
    #viewer {
      width: 100vw;
      height: 100vh;
      position: relative;
      min-width: 0;
    }

    canvas { display:block; }

    /* -------------------------------------------------- */
    /* TOP LEFT TITLE + DESCRIPTION                       */
    /* -------------------------------------------------- */
    #headerBox {
      position: absolute;
      top: 12px;
      left: 12px;
      z-index: 30;
      color: #000;
      background: rgba(255,255,255,0.85);
      padding: 12px 16px;
      border-radius: 10px;
      max-width: 280px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    #headerBox h1 {
      margin: 0;
      font-size: 22px;
      font-weight: bold;
    }
    #headerBox p {
      margin: 6px 0 0 0;
      line-height: 1.3em;
      font-size: 13px;
      color:#333;
    }

    /* -------------------------------------------------- */
    /* UI BUTTONS                                         */
    /* -------------------------------------------------- */
    #uiPanel {
      position: absolute;
      top: 12px;
      right: 12px;
      display: flex;
      gap: 8px;
      z-index: 40;
      flex-wrap: wrap;
      max-width: calc(100% - 40px);
      align-items: center;
    }

    .ui-btn {
      padding: 8px 10px;
      border: none;
      background: var(--ui-bg);
      color: var(--ui-color);
      cursor: pointer;
      border-radius: 5px;
      font-size: 13px;
      opacity: 0.95;
      white-space: nowrap;
    }
    .ui-btn:hover { opacity: 1; }

    /* -------------------------------------------------- */
    /* LOADING SCREEN                                     */
    /* -------------------------------------------------- */
    #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(255,255,255,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 2000;
      font-size: 20px;
      color: #333;
    }

    #progressBar {
      width: 300px;
      max-width: calc(100% - 40px);
      height: 12px;
      background: #ddd;
      border-radius: 6px;
      margin-top: 15px;
      overflow: hidden;
    }

    #progressFill {
      width: 0%;
      height: 100%;
      background: #44aaff;
      transition: width 0.2s ease-out;
    }

    /* -------------------------------------------------- */
    /* FLOATING THUMBNAIL STRIP                          */
    /* -------------------------------------------------- */
    #thumbStrip {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;
      z-index: 30;
      display: flex;
      gap: 10px;
      align-items: center;
      background: rgba(255,255,255,0.85);
      padding: 8px 12px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      max-width: calc(100% - 40px);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .thumb {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      cursor: pointer;
      width: var(--thumb-size);
      min-width: var(--thumb-size);
      gap:6px;
    }
    .thumb img {
      width: var(--thumb-size);
      height: var(--thumb-size);
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
      border: 2px solid transparent;
    }
    .thumb .label {
      font-size: 12px;
      color:#222;
      max-width: var(--thumb-size);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .thumb.selected img { border-color: #44aaff; transform: scale(0.98); }

    /* Responsive */
    @media (max-width: 700px) {
      :root { --thumb-size: 64px; }
      .ui-btn { font-size:12px; padding:6px 8px; }
    }
  </style>

  <!-- Import Map -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>
</head>

<body>

<!-- Loading Screen -->
<div id="loadingScreen">
  <div>Loading model...</div>
  <div id="progressBar">
    <div id="progressFill"></div>
  </div>
</div>

<!-- Main Viewer -->
<div id="viewer">

  <!-- TOP LEFT Heading Box -->
  <div id="headerBox">
    <h1>3D Design</h1>
    <!-- <p>Experience your Custom Wedding Decor Designs in 3D! Our detailed models let you explore your wedding setup from every angle, ensuring every detail is exactly as you envisioned before we bring it to life</p> -->
  </div>

  <!-- UI Buttons -->
  <div id="uiPanel">
    <button class="ui-btn" id="resetBtn">Reset</button>
    <button class="ui-btn" id="rotateBtn">Auto-Rotate: ON</button>
    <button class="ui-btn" id="zoomInBtn">Zoom +</button>
    <button class="ui-btn" id="zoomOutBtn">Zoom -</button>
    <button class="ui-btn" id="fullscreenBtn">Fullscreen</button>
  </div>

  <!-- Floating Thumbnail Strip -->
  <div id="thumbStrip"></div>

</div>

<script type="module">
import * as THREE from "three";
import { OrbitControls } from "three/addons/controls/OrbitControls.js";
import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
import { RGBELoader } from "three/addons/loaders/RGBELoader.js";

const loadingScreen = document.getElementById('loadingScreen');
const progressFill = document.getElementById('progressFill');
const thumbStrip = document.getElementById('thumbStrip');

// -------------------------------------------
// Scene
// -------------------------------------------
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xffffff);

// Camera
const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.set(2, 2, 4);

// Renderer
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.physicallyCorrectLights = true;
renderer.outputColorSpace = THREE.SRGBColorSpace;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.0;
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;

document.getElementById('viewer').appendChild(renderer.domElement);

// Controls
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.enablePan = true;

// Lighting
const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
dirLight.position.set(5, 10, 5);
dirLight.castShadow = true;
scene.add(dirLight);

scene.add(new THREE.AmbientLight(0xffffff, 0.4));

// Ground shadow plane
const groundGeo = new THREE.PlaneGeometry(40, 40);
const groundMat = new THREE.ShadowMaterial({ opacity: 0.18 });
const ground = new THREE.Mesh(groundGeo, groundMat);
ground.rotation.x = -Math.PI / 2;
ground.position.y = -0.01;
ground.receiveShadow = true;
scene.add(ground);

// HDRI Environment
new RGBELoader().load(
  "https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/studio_small_08_1k.hdr",
  (hdr) => {
    hdr.mapping = THREE.EquirectangularReflectionMapping;
    scene.environment = hdr;
  }
);

// -------------------------------------------
// Model Loader
// -------------------------------------------
const gltfLoader = new GLTFLoader();
let currentModel = null;
let autoRotate = true;

function fitModelToView(obj, padding = 1.25) {
  const box = new THREE.Box3().setFromObject(obj);
  const size = new THREE.Vector3();
  box.getSize(size);

  const center = new THREE.Vector3();
  box.getCenter(center);
  obj.position.sub(center);

  const maxDim = Math.max(size.x, size.y, size.z);
  const fov = camera.fov * (Math.PI / 180);
  const camDist = (maxDim * padding) / (2 * Math.tan(fov / 2));

  const dir = new THREE.Vector3().subVectors(camera.position, controls.target).normalize();
  camera.position.copy(controls.target).addScaledVector(dir, camDist);
}

function loadModel(path, markThumb) {
  if (currentModel) {
    scene.remove(currentModel);
    currentModel = null;
  }

  loadingScreen.style.display = "flex";
  progressFill.style.width = "0%";

  gltfLoader.load(
    path,
    (gltf) => {
      currentModel = gltf.scene;

      currentModel.traverse(o => {
        if (o.isMesh) {
          o.castShadow = true;
          o.receiveShadow = true;
        }
      });

      fitModelToView(currentModel, 1.15);
      scene.add(currentModel);
      loadingScreen.style.display = "none";

      if (markThumb) selectThumb(path);
    },
    (xhr) => {
      if (xhr.total) {
        const pct = (xhr.loaded / xhr.total) * 100;
        progressFill.style.width = pct + "%";
      }
    },
    () => alert("Error loading model")
  );
}

// -------------------------------------------
// UI Buttons
// -------------------------------------------
document.getElementById('resetBtn').onclick = () => {
  controls.target.set(0,0,0);
  camera.position.set(2,2,4);
  controls.update();
};

document.getElementById('rotateBtn').onclick = (e) => {
  autoRotate = !autoRotate;
  e.target.innerText = "Auto-Rotate: " + (autoRotate ? "ON" : "OFF");
};

document.getElementById('zoomInBtn').onclick = () => zoomBy(1.25);
document.getElementById('zoomOutBtn').onclick = () => zoomBy(0.8);

document.getElementById('fullscreenBtn').onclick = () => {
  if (!document.fullscreenElement)
    document.documentElement.requestFullscreen();
  else
    document.exitFullscreen();
};

function zoomBy(f) {
  const dir = new THREE.Vector3().subVectors(camera.position, controls.target);
  dir.multiplyScalar(1 / f);
  camera.position.copy(controls.target).add(dir);
}

// -------------------------------------------
// Thumbnails (from your files)
// -------------------------------------------
const models = [
  { model: "models/flowervase.glb", thumb: "thumbnails/flower.jpg", label: "Model 1" },
  { model: "models/mobile_phone.glb", thumb: "thumbnails/phone.jpg", label: "Model 2" },
  { model: "models/street_stall.glb", thumb: "thumbnails/food.jpg", label: "Model 3" },
  { model: "models/stall.glb", thumb: "thumbnails/food.jpg", label: "Model 4" }
];

models.forEach(item => {
  const el = document.createElement("div");
  el.className = "thumb";
  el.dataset.model = item.model;

  const img = document.createElement("img");
  img.src = item.thumb;
  img.alt = item.label;

  const label = document.createElement("div");
  label.className = "label";
  label.textContent = item.label;

  el.appendChild(img);
  el.appendChild(label);
  el.onclick = () => loadModel(item.model, true);

  thumbStrip.appendChild(el);
});

function selectThumb(modelPath) {
  document.querySelectorAll(".thumb").forEach(t => {
    t.classList.toggle("selected", t.dataset.model === modelPath);
  });
}

selectThumb(models[0].model);
loadModel(models[0].model, true);

// -------------------------------------------
// Animation loop
// -------------------------------------------
function animate() {
  requestAnimationFrame(animate);
  if (currentModel && autoRotate) currentModel.rotation.y += 0.003;
  controls.update();
  renderer.render(scene, camera);
}
animate();

// Resize
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
